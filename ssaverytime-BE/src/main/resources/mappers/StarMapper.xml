<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssaverytime.server.mapper.StarMapper">

    <!-- INSERT -->
    <insert id="insertStar"
            parameterType="com.ssaverytime.server.domain.model.Star"
            useGeneratedKeys="true"
            keyProperty="starId">
        INSERT INTO STAR (USER_ID, RESTAURANT_ID, CATEGORY, SCORE, DATE)
        VALUES (#{userId}, #{restaurantId}, #{category}, #{score}, #{date})
    </insert>

    <!-- 같은 USER + RESTAURANT + CATEGORY + DATE 에 대해 점수만 갱신 -->
    <update id="updateStar">
        UPDATE STAR
        SET SCORE = #{score}
        WHERE USER_ID = #{userId}
        AND RESTAURANT_ID = #{restaurantId}
        AND CATEGORY = #{category}
        AND DATE = #{date}
    </update>

    <!-- 날짜 구간 + 식당 + 카테고리로 평균 점수 조회 -->
    <select id="findAverageScore" resultType="double">
        SELECT AVG(SCORE)
        FROM STAR
        WHERE RESTAURANT_ID = #{restaurantId}
        AND CATEGORY = #{category}
        AND DATE BETWEEN #{start} AND #{end}
    </select>

</mapper>
